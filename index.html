<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Spyne Outsource Dashboard</title>
  <link rel="icon" href="https://spyne-prod-ai.s3.us-east-1.amazonaws.com/ai-dataset/2025/favicon.ico" type="image/x-icon">
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f7fa; margin: 0; padding: 20px; }
    .section { background: #fff; border: 1px solid #ccc; border-radius: 4px; padding: 15px; margin-bottom: 20px; }
    h2 { text-align: center; margin-top: 0; }
    table { width: 100%; border-collapse: collapse; margin-bottom: 15px; }
    th, td { padding: 8px; border: 1px solid #ddd; text-align: center; }
    th { background: #eee; }
    #dailyChart { max-width: 100%; height: 300px; }
  </style>
</head>
<body>

  <div class="section"><h2>Spyne Outsource</h2></div>

  <div class="section">
    <h2>Daily Count Desc Bar</h2>
    <canvas id="dailyChart"></canvas>
    <div id="daily-summary-table"></div>
  </div>

  <div class="section">
    <h2>Active User</h2>
    <div id="live-user"></div>
  </div>

  <div class="section">
    <h2>User Data Dateâ€‘wise (Editor = Email, Images = Total)</h2>
    <div id="user-data"></div>
  </div>

  <script>
    const dailyDataURL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQkSnj-ldXkXXW21Jg2NIHO4b5B_KPHAJwy3T8_1L0-mPdGu_wrMC43nJb7bcAxXD7-xhNy3pqEZm18/pub?gid=585003148&single=true&output=csv';
    const liveUserURL  = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQkSnj-ldXkXXW21Jg2NIHO4b5B_KPHAJwy3T8_1L0-mPdGu_wrMC43nJb7bcAxXD7-xhNy3pqEZm18/pub?gid=1885524675&single=true&output=csv';

    function renderTable(elId, data) {
      const cols = Object.keys(data[0]);
      const header = `<thead><tr>${cols.map(c => `<th>${c}</th>`).join('')}</tr></thead>`;
      const body = `<tbody>${data.map(r =>
        `<tr>${cols.map(c => `<td>${r[c]}</td>`).join('')}</tr>`
      ).join('')}</tbody>`;
      document.getElementById(elId).innerHTML = `<table>${header}${body}</table>`;
    }

    Papa.parse(liveUserURL, {
      download: true, header: true, skipEmptyLines: true,
      complete: res => {
        if (!res.data.length) return;
        renderTable('live-user', res.data);
      }
    });

    Papa.parse(dailyDataURL, {
      download: true, header: true, skipEmptyLines: true,
      complete: res => {
        const raw = res.data;
        if (!raw.length) return;

        const totalsByDate = raw.reduce((acc, row) => {
          const dt = row.Date;
          const img = +row.Images || 0;
          acc[dt] = (acc[dt] || 0) + img;
          return acc;
        }, {});

        const dates = Object.keys(totalsByDate).sort();
        const counts = dates.map(d => totalsByDate[d]);

        new Chart(document.getElementById('dailyChart').getContext('2d'), {
          type: 'bar',
          data: {
            labels: dates,
            datasets: [{
              label: 'Images per Day',
              data: counts,
              backgroundColor: '#4caf50'
            }]
          },
          options: {
            scales: {
              x: { ticks: { autoSkip: false, maxRotation: 90, minRotation: 45 } }
            },
            plugins: {
              legend: { display: false }
            }
          }
        });

        const rows = dates.map(d => ({ Date: d, 'Total Images': totalsByDate[d].toString() }));
        renderTable('daily-summary-table', rows);

        const emails = [...new Set(raw.map(r => r.Editor))];
        const emailTotals = {};
        emails.forEach(e => {
          emailTotals[e] = raw
            .filter(r => r.Editor === e)
            .reduce((sum, r) => sum + (+r.Images || 0), 0);
        });

        const header = `<th>Email</th><th>Images</th>` + dates.map(d => `<th>${d}</th>`).join('');
        const body = emails.map(e => {
          const cells = `<td>${e}</td><td>${emailTotals[e]}</td>` + dates.map(d => {
            const rec = raw.find(r => r.Editor === e && r.Date === d);
            return `<td>${rec ? rec.Images : 0}</td>`;
          }).join('');
          return `<tr>${cells}</tr>`;
        }).join('');

        document.getElementById('user-data').innerHTML =
          `<table><thead><tr>${header}</tr></thead><tbody>${body}</tbody></table>`;
      }
    });
  </script>
</body>
</html>
